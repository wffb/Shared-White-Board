### 改良并发性

本项目是基于课程作业改写而来，处于时间原因设计有很多不妥之处。借着这个机会，重新理清一下并发设计的思路。



#### 并发结构

我认为并发设计首先可以从<u>任务设计</u>，即我们要解决：

- 有哪些任务可以并行执行（在这其中有需要怎样的控制顺序）
- 有哪些资源会发生竞争

理清了并发结构设计，才有可能设计出成功的并发设计。

在改造程序时我也注意到，一些在单线程下便利的设计（比如工具类中复用静态向量）就会在多线程出现冲突。因此理想状态下应该是 <u>任务设计 和 并发设计</u> 同时完成的。随后在编码时同时考虑功能和并发安全的实现。



#### 并发控制

由于加入了 WorkerPoolExecutor 需要通过一些手段进行并发控制，这里主要通过两种手段：

- CAS： （通过信号量或者其他值）主要对一些比较轻量化且并发要求没有那么严格的情景
- 锁 ：严格的执行并发控制，但是比较重

问题不只在于选择怎样的并发控制手段，还在于具体来说怎样控制并发范围。 在改造时我主要着重于两点：

- 将并发资源统一存储管理，并提供并发安全的调用方法 （比如将 `Users` 单独放入 `UserProcessor` 管理）
- 将并发的范围控制在尽可能小且集中 （也就是尽量将<u>非并发操作移出并发控制区</u>）

这两点中前者往往能很好的帮助后者，目的在于尽可能减少阻塞提高系统流量



#### 待改进

当然并发控制远不止只有锁和CAS这样简单的手段，之后希望一会尝试一下 `CompletableFuture` 和 `LockSupport` 等手段